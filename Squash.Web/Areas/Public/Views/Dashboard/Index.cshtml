@model Squash.Web.Areas.Public.Models.DashboardViewModel
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer

@{
    Model.Title = Localizer["Title"].Value;
}

<div class="container py-4 dashboard-page">
    <div class="card shadow-sm dashboard-hero">
        <div class="card-body d-flex flex-column flex-lg-row gap-4 align-items-start align-items-lg-center">
            <div class="position-relative">
                <div class="dashboard-avatar">
                    @if (!string.IsNullOrWhiteSpace(Model.PictureUrl))
                    {
                        <img src="@Model.PictureUrl" alt="@Model.PlayerName" class="dashboard-avatar-image" />
                    }
                    else
                    {
                        <span>@Model.Initials</span>
                    }
                </div>
                <a class="btn btn-light btn-sm dashboard-avatar-btn" href="@Url.Action("Index", "Profile", new { culture = (string?)Context.Request.RouteValues["culture"] ?? "en" })" aria-label="@Localizer["UploadPhoto"]">
                    <svg class="icon"><use xlink:href="/images/icons.svg#cil-camera"></use></svg>
                </a>
            </div>
            <div class="flex-grow-1">
                <div class="d-flex align-items-center gap-2 flex-wrap">
                    <h1 class="h3 mb-0">@Model.PlayerName</h1>
                    <a class="btn btn-sm btn-outline-secondary dashboard-edit" href="@Url.Action("Index", "Profile", new { culture = (string?)Context.Request.RouteValues["culture"] ?? "en" })" aria-label="@Localizer["EditProfile"]">
                        <svg class="icon"><use xlink:href="/images/icons.svg#cil-pen"></use></svg>
                    </a>
                </div>
                <div class="text-body-secondary mt-2 d-flex flex-wrap gap-3 align-items-center">
                    <span>@Localizer["ImaIdLabel"] <strong>@(Model.ImaId ?? Localizer["NotAvailable"].Value)</strong></span>
                    <a href="#" class="text-decoration-none" onclick="alert('@Localizer["ExternalProfilePending"]'); return false;">
                        @Localizer["EsfIdLabel"] <strong>@(Model.EsfId ?? Localizer["NotAvailable"].Value)</strong>
                    </a>
                    <a href="#" class="text-decoration-none" onclick="alert('@Localizer["ExternalProfilePending"]'); return false;">
                        @Localizer["RankedinIdLabel"] <strong>@(Model.RankedinId ?? Localizer["NotAvailable"].Value)</strong>
                    </a>
                    <span class="d-flex align-items-center gap-2">
                        @if (!string.IsNullOrWhiteSpace(Model.CountryFlagUrl))
                        {
                            <img src="@Model.CountryFlagUrl" alt="@Model.CountryName" class="dashboard-flag" />
                        }
                        @Localizer["CountryLabel"] @(Model.CountryName ?? Localizer["NotAvailable"].Value)
                    </span>
                    <span>@Localizer["AgeLabel"] @(Model.Age?.ToString() ?? Localizer["NotAvailable"].Value)</span>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm mt-4">
        <div class="card-body">
            <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
                <h2 class="h5 mb-0">@Localizer["StatsTitle"]</h2>
                <div class="dashboard-tabs nav nav-pills" data-dashboard-tabs>
                    <button type="button" class="nav-link active" data-tab="total">@Localizer["StatsTotal"]</button>
                    <button type="button" class="nav-link" data-tab="singles">@Localizer["StatsSingles"]</button>
                    <button type="button" class="nav-link" data-tab="doubles">@Localizer["StatsDoubles"]</button>
                    <button type="button" class="nav-link" data-tab="mixed">@Localizer["StatsMixed"]</button>
                </div>
            </div>

            <div class="mt-4">
                <div class="dashboard-stats-panel is-active" data-tab-panel="total">
                    <div class="dashboard-stat-row">
                        <div>
                            <div class="fw-semibold">@Localizer["WinLossCareer"]</div>
                            <div class="text-body-secondary">@Model.Stats.CareerWins / @Model.Stats.CareerLosses</div>
                        </div>
                        <div class="dashboard-bar">
                            <span style="width:@Model.Stats.CareerWinPercent%"></span>
                        </div>
                        <div class="text-body-secondary">@Model.Stats.CareerTotal</div>
                    </div>
                    <div class="dashboard-stat-row">
                        <div>
                            <div class="fw-semibold">@Localizer["WinLossYear"]</div>
                            <div class="text-body-secondary">@Model.Stats.YearWins / @Model.Stats.YearLosses</div>
                        </div>
                        <div class="dashboard-bar">
                            <span style="width:@Model.Stats.YearWinPercent%"></span>
                        </div>
                        <div class="text-body-secondary">@Model.Stats.YearTotal</div>
                    </div>
                    <div class="dashboard-form">
                        <span>@Localizer["FormLabel"]</span>
                        @if (Model.Stats.FormResults.Count > 0)
                        {
                            <span class="text-body-secondary">@string.Join(" ", Model.Stats.FormResults)</span>
                        }
                        else
                        {
                            <span class="text-body-secondary">@Localizer["FormEmpty"]</span>
                        }
                    </div>
                </div>
                <div class="dashboard-stats-panel" data-tab-panel="singles">
                    <div class="dashboard-stat-row">
                        <div>
                            <div class="fw-semibold">@Localizer["WinLossCareer"]</div>
                            <div class="text-body-secondary">@Model.StatsSingles.CareerWins / @Model.StatsSingles.CareerLosses</div>
                        </div>
                        <div class="dashboard-bar">
                            <span style="width:@Model.StatsSingles.CareerWinPercent%"></span>
                        </div>
                        <div class="text-body-secondary">@Model.StatsSingles.CareerTotal</div>
                    </div>
                    <div class="dashboard-stat-row">
                        <div>
                            <div class="fw-semibold">@Localizer["WinLossYear"]</div>
                            <div class="text-body-secondary">@Model.StatsSingles.YearWins / @Model.StatsSingles.YearLosses</div>
                        </div>
                        <div class="dashboard-bar">
                            <span style="width:@Model.StatsSingles.YearWinPercent%"></span>
                        </div>
                        <div class="text-body-secondary">@Model.StatsSingles.YearTotal</div>
                    </div>
                    <div class="dashboard-form">
                        <span>@Localizer["FormLabel"]</span>
                        @if (Model.StatsSingles.FormResults.Count > 0)
                        {
                            <span class="text-body-secondary">@string.Join(" ", Model.StatsSingles.FormResults)</span>
                        }
                        else
                        {
                            <span class="text-body-secondary">@Localizer["FormEmpty"]</span>
                        }
                    </div>
                </div>
                <div class="dashboard-stats-panel" data-tab-panel="doubles">
                    <div class="dashboard-stat-row">
                        <div>
                            <div class="fw-semibold">@Localizer["WinLossCareer"]</div>
                            <div class="text-body-secondary">@Model.StatsDoubles.CareerWins / @Model.StatsDoubles.CareerLosses</div>
                        </div>
                        <div class="dashboard-bar">
                            <span style="width:@Model.StatsDoubles.CareerWinPercent%"></span>
                        </div>
                        <div class="text-body-secondary">@Model.StatsDoubles.CareerTotal</div>
                    </div>
                    <div class="dashboard-stat-row">
                        <div>
                            <div class="fw-semibold">@Localizer["WinLossYear"]</div>
                            <div class="text-body-secondary">@Model.StatsDoubles.YearWins / @Model.StatsDoubles.YearLosses</div>
                        </div>
                        <div class="dashboard-bar">
                            <span style="width:@Model.StatsDoubles.YearWinPercent%"></span>
                        </div>
                        <div class="text-body-secondary">@Model.StatsDoubles.YearTotal</div>
                    </div>
                    <div class="dashboard-form">
                        <span>@Localizer["FormLabel"]</span>
                        @if (Model.StatsDoubles.FormResults.Count > 0)
                        {
                            <span class="text-body-secondary">@string.Join(" ", Model.StatsDoubles.FormResults)</span>
                        }
                        else
                        {
                            <span class="text-body-secondary">@Localizer["FormEmpty"]</span>
                        }
                    </div>
                </div>
                <div class="dashboard-stats-panel" data-tab-panel="mixed">
                    <div class="dashboard-stat-row">
                        <div>
                            <div class="fw-semibold">@Localizer["WinLossCareer"]</div>
                            <div class="text-body-secondary">@Model.StatsMixed.CareerWins / @Model.StatsMixed.CareerLosses</div>
                        </div>
                        <div class="dashboard-bar">
                            <span style="width:@Model.StatsMixed.CareerWinPercent%"></span>
                        </div>
                        <div class="text-body-secondary">@Model.StatsMixed.CareerTotal</div>
                    </div>
                    <div class="dashboard-stat-row">
                        <div>
                            <div class="fw-semibold">@Localizer["WinLossYear"]</div>
                            <div class="text-body-secondary">@Model.StatsMixed.YearWins / @Model.StatsMixed.YearLosses</div>
                        </div>
                        <div class="dashboard-bar">
                            <span style="width:@Model.StatsMixed.YearWinPercent%"></span>
                        </div>
                        <div class="text-body-secondary">@Model.StatsMixed.YearTotal</div>
                    </div>
                    <div class="dashboard-form">
                        <span>@Localizer["FormLabel"]</span>
                        @if (Model.StatsMixed.FormResults.Count > 0)
                        {
                            <span class="text-body-secondary">@string.Join(" ", Model.StatsMixed.FormResults)</span>
                        }
                        else
                        {
                            <span class="text-body-secondary">@Localizer["FormEmpty"]</span>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm mt-4">
        <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
                <h2 class="h5 mb-0">@Localizer["RecentMatches"]</h2>
                @if (Model.RecentMatches.Count > 0)
                {
                    <a href="#" class="btn btn-link px-0">@Localizer["ViewAll"]</a>
                }
            </div>
            @if (Model.RecentMatches.Count == 0)
            {
                <div class="dashboard-empty mt-3">@Localizer["RecentMatchesEmpty"]</div>
            }
            else
            {
                <div class="mt-3 d-grid gap-3">
                    @foreach (var match in Model.RecentMatches)
                    {
                        <div class="dashboard-match">
                            <div class="dashboard-match-top">
                                <div class="dashboard-match-players">
                                    <div class="dashboard-match-player">
                                        @if (match.Player1IsWinner)
                                        {
                                            <span class="dashboard-match-dot" aria-hidden="true"></span>
                                        }
                                        @if (!string.IsNullOrWhiteSpace(match.Player1FlagUrl))
                                        {
                                            <img src="@match.Player1FlagUrl" alt="@match.Player1Name" class="dashboard-flag" />
                                        }
                                        <span class="dashboard-match-name">@match.Player1Name</span>
                                    </div>
                                    <span class="dashboard-match-sep">-</span>
                                    <div class="dashboard-match-player">
                                        @if (!string.IsNullOrWhiteSpace(match.Player2FlagUrl))
                                        {
                                            <img src="@match.Player2FlagUrl" alt="@match.Player2Name" class="dashboard-flag" />
                                        }
                                        <span class="dashboard-match-name">@match.Player2Name</span>
                                        @if (match.Player2IsWinner)
                                        {
                                            <span class="dashboard-match-dot" aria-hidden="true"></span>
                                        }
                                    </div>
                                </div>
                                <div class="dashboard-match-score">
                                    @(string.IsNullOrWhiteSpace(match.ScoreLine) ? "-" : match.ScoreLine)
                                </div>
                            </div>
                            <div class="dashboard-match-bottom">
                                <div class="dashboard-match-meta">
                                    @if (!string.IsNullOrWhiteSpace(match.TournamentFlagUrl))
                                    {
                                        <img src="@match.TournamentFlagUrl" alt="@match.TournamentName" class="dashboard-flag" />
                                    }
                                    <span class="dashboard-match-tournament">@match.TournamentName</span>
                                    @if (match.MatchDate.HasValue)
                                    {
                                        <span class="dashboard-match-date">@match.MatchDate.Value.ToString("d")</span>
                                    }
                                </div>
                                <span class="dashboard-match-result @(match.ResultLabel == "W" ? "is-win" : match.ResultLabel == "L" ? "is-loss" : "is-neutral")">@match.ResultLabel</span>
                            </div>
                        </div>
                    }
                </div>
            }
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var tabs = document.querySelectorAll("[data-dashboard-tabs] .nav-link");
        var panels = document.querySelectorAll("[data-tab-panel]");
        if (!tabs.length || !panels.length) {
            return;
        }

        tabs.forEach(function (tab) {
            tab.addEventListener("click", function () {
                var target = tab.getAttribute("data-tab");
                tabs.forEach(function (item) { item.classList.remove("active"); });
                panels.forEach(function (panel) { panel.classList.remove("is-active"); });
                tab.classList.add("active");
                var panel = document.querySelector('[data-tab-panel="' + target + '"]');
                if (panel) {
                    panel.classList.add("is-active");
                }
            });
        });
    });
</script>
