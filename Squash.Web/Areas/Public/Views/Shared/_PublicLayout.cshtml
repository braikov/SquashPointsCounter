@using System.Globalization
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@{
    var path = Context.Request.Path.Value ?? "/";
    var isBg = path.StartsWith("/bg", StringComparison.OrdinalIgnoreCase);
    var cultureSegment = isBg ? "bg" : "en";
    var targetPrefix = isBg ? "/en" : "/bg";
    var trimmedPath = path.StartsWith("/bg", StringComparison.OrdinalIgnoreCase) || path.StartsWith("/en", StringComparison.OrdinalIgnoreCase)
        ? path.Substring(3)
        : path;
    var switchUrl = string.IsNullOrEmpty(trimmedPath) ? targetPrefix : targetPrefix + trimmedPath;
    var returnUrl = Context.Request.Path + Context.Request.QueryString;
    var loginUrl = Url.Action("Login", "Account", new { area = "Identity", returnUrl });
    var registerUrl = Url.Action("Register", "Account", new { area = "Public", culture = cultureSegment, returnUrl });
    var isAuthenticated = User?.Identity?.IsAuthenticated ?? false;

    var baseModel = Model as Squash.Web.Areas.Public.Models.PageViewModel;
    var pageTitle = baseModel?.Title;
    var siteTitle = Localizer["SiteTitle"].Value;
    var fullTitle = string.IsNullOrWhiteSpace(pageTitle) ? siteTitle : $"{pageTitle} | {siteTitle}";
    var metaDescription = baseModel?.MetaDescription;
    var canonicalUrl = baseModel?.CanonicalUrl;
}

<!DOCTYPE html>
<html lang="@CultureInfo.CurrentUICulture.TwoLetterISOLanguageName">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="~/favicon.ico" />
    <title>@fullTitle</title>
    @if (!string.IsNullOrWhiteSpace(metaDescription))
    {
        <meta name="description" content="@metaDescription" />
    }
    @if (!string.IsNullOrWhiteSpace(canonicalUrl))
    {
        <link rel="canonical" href="@canonicalUrl" />
    }
    <link rel="stylesheet" href="~/lib/coreui/dist/css/coreui.min.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/lib/simplebar/dist/simplebar.min.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/shared.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/auth.css" asp-append-version="true" />
    @RenderSection("Head", required: false)
</head>
<body class="bg-body-tertiary min-vh-100 d-flex flex-column">
    <header>
        <nav class="d-flex align-items-center justify-content-between">
            <div class="d-flex gap-2">
                <a href="@switchUrl">
                @(isBg ? Localizer["SwitchToEn"] : Localizer["SwitchToBg"])
                </a>
            </div>
            <div class="d-flex gap-3">
                @if (isAuthenticated)
                {
                    <form asp-action="Logout" asp-controller="Account" asp-area="Identity" method="post" class="d-inline">
                        <button type="submit" class="btn btn-link p-0">@Localizer["Logout"]</button>
                    </form>
                }
                else
                {
                    <a href="@loginUrl">@Localizer["Login"]</a>
                    <a href="@registerUrl">@Localizer["Register"]</a>
                }
            </div>
        </nav>
    </header>
    <main>
        @RenderBody()
    </main>
    <script src="~/lib/jquery/dist/jquery.min.js" asp-append-version="true"></script>
    <script src="~/lib/coreui/dist/js/coreui.bundle.min.js" asp-append-version="true"></script>
    <script src="~/lib/simplebar/dist/simplebar.min.js" asp-append-version="true"></script>
    @RenderSection("Scripts", required: false)
</body>
</html>
